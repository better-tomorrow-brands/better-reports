# v1.3.0 — Charts, Detail Pages & UX Polish

## Summary

Minor release adding performance charts at every level of the Facebook Ads hierarchy (campaign, ad set, ad creative), new detail pages for campaigns and ad sets, a notebook stub for future AI context, and a collection of UX improvements including theme fixes, image proxy fixes, and the /inventory → /products rename.

---

## Changes

### Campaign Detail Page — Charts & Notebook

- **Performance chart** added above the ad sets table on `/campaigns/[id]`
- Normalized multi-series line chart with 9 togglable series: Spend, Impressions, Reach, CPC, CTR, Cost/Result, Frequency, Results, CPM
- All series share one Y axis via 0–100 normalisation; raw values shown in the tooltip
- Visible series persisted to `localStorage` per campaign
- **Notebook** textarea stub below the ad sets table; placeholder for future AI context features

### Ad Set Detail Page (`/campaigns/[id]/adsets/[adsetId]`)

New dedicated page for each ad set, accessible via the → button on ad set rows:

- Breadcrumb navigation: Campaigns → Campaign → Ad Set
- Date range picker (defaults to Last 30 days)
- **Ad set performance chart** (daily time series from `facebook-adsets?groupBy=day`)
- **Ad creatives table** with per-ad accordion expand
  - Each row shows thumbnail, ad name, and all metric columns
  - Clicking a row lazily fetches and renders a daily chart for that ad
- **Notebook** textarea stub
- Series visibility persisted per ad set in `localStorage`

### Ad Creative Charts (Accordion, Lazy)

- Each ad creative row on both the campaign page and ad set detail page has an expand chevron
- Clicking expands an inline chart panel; chart only fetches data when first expanded (no premature rendering or fetching)
- Chart uses the same normalized multi-series component with series toggles
- Series visibility persisted per ad (`ad-chart-series-{adId}`)

### → Navigation Button on Ad Set Rows

- Campaign detail page ad set table now has a dedicated → button column
- Clicking navigates to `/campaigns/[id]/adsets/{adsetId}`
- Action is separate from the accordion expand (click row = expand ads; click → = go to detail page)

### API Extensions — Daily Time Series

Three API routes extended or added to support `groupBy=day`:

- **`GET /api/reports/facebook-campaigns`** — new route
  - `?from=&to=&campaignId=&groupBy=day` → daily rows
  - `?from=&to=&campaignId=` → aggregated totals
  - Supports `campaignId` or `utmCampaign` filter
- **`GET /api/reports/facebook-adsets`** — extended
  - Added `groupBy=day` mode: requires `adsetId` (or `adset` name), returns daily rows
  - Aggregated mode unchanged
- **`GET /api/reports/facebook-ad-creatives`** — extended
  - Added `groupBy=day` mode: requires `adId`, returns daily rows
  - Aggregated mode unchanged

All daily endpoints return: `date, spend, impressions, reach, frequency, clicks, linkClicks, purchases, purchaseValue, ctr, cpc, cpm, costPerResult, roas`

### Ad Creative Lightbox — Image Proxy Fixes

- Removed `stp` query param stripping from the image proxy; Meta CDN URLs are signed and stripping `stp` caused 403s
- Added error state in the Lightbox: proxy errors now display an error message instead of an infinite spinner
- `Lightbox` and `AdThumbnail` now call `useOrg()` directly (previously received `apiFetch` as a prop, which could be a stale closure causing "Missing or invalid X-Org-Id header" errors)

### Ad Creative Lightbox — Square Image Variant

- Added `asset_feed_spec{images}` to the creative fields request
- Uses image hashes to call the `adimages` API for full-resolution originals
- Picks the squarest uploaded image (closest 1:1 ratio) as the lightbox `fullUrl`
- Falls back to the `thumbnail_width=1080` creative endpoint if no feed images exist

### Theme System Improvements

- `ThemeContext` now reads `localStorage` synchronously in the `useState` initializer (no flash on load)
- `setTheme()` calls `applyThemeToDOM()` immediately rather than waiting for `useEffect`
- Default theme for new users changed from `"system"` to `"light"` to avoid unexpected dark mode
- Inline script in `layout.tsx` updated: only applies dark class for explicit `t === 'dark'` or `t === 'system'` (previously any non-`'light'` value triggered dark)
- Settings → Appearance: added note that System mode may show as dark in Brave (fingerprinting protection spoofs `prefers-color-scheme`)

### /inventory → /products Rename

- `/inventory` page renamed to `/products`
- Sidebar link updated from `/inventory` to `/products`
- Page headline changed from "Inventory" to "Products"
- Old `/inventory` route redirects to `/products` for any existing links

### Settings — Preferences Layout

- Currency dropdown and Save button now display inline (`flex items-center gap-3`) instead of stacking vertically
